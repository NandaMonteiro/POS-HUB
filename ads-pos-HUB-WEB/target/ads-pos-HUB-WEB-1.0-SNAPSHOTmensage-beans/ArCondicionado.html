<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Ar Condicionado</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Bootstrap -->
        <link rel="stylesheet" href="componentes/css/bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="componentes/css/edicao-pagina.css" type="text/css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

        <script type="text/javascript" >

            var estado;
            var temperatura;
            var temperaturaMaxima;
            var temperaturaMinima;

            $(document).ready(function () {
                // Pegar propriedades do arcondicionado
                getPropriedades();

                // Exibir status do arcondicionado
                exibirStatus();

                // Mostrar informacoes da temperatura
                exibirTemperatura();

                $("#btn-io").click(function () {
                    $.ajax({
                        method: "POST",
                        url: "http://localhost:8080/ProjetoMQTT/api/arcondicionado/ligar"
                    }).done(function (data) {
                        // Exibir status
                        exibirStatus();
                        // Mostrar informacoes da temperatura
                        exibirTemperatura();
                    });
                });
                $("#btn-aumentar").click(function () {
                    $.ajax({
                        method: "POST",
                        url: "http://localhost:8080/ProjetoMQTT/api/arcondicionado/mudarTemperatura/(elevar)",
                        data: {elevar: true}
                    }).done(function (result) {
                        exibirTemperatura();
                    }).fail(function(erro) {
                        alert(JSON.stringify(erro));
                    });
                });
                $("#btn-diminuir").click(function () {
                    $.ajax({
                        method: "POST",
                        url: "http://localhost:8080/ProjetoMQTT/api/arcondicionado/mudarTemperatura/(elevar)",
                        data: {elevar: false}
                    }).done(function (result) {
                        exibirTemperatura();
                    }).fail(function(erro) {
                        alert(JSON.stringify(erro));
                    });
                });
            });

            function getPropriedades() {
                // Pegar valores das propriedades do arcondicionado
                $.getJSON("http://localhost:8080/ProjetoMQTT/api/arcondicionado/propriedades", function (resultado) {
                    temperaturaMinima = resultado.temperaturaMinima;
                    temperaturaMaxima = resultado.temperaturaMaxima;
                });
            }

            function exibirStatus() {
                $.getJSON("http://localhost:8080/ProjetoMQTT/api/arcondicionado/estado", function (resultado) {
                    estado = resultado.estado;
                    // Exibir a temperatura atual (caso esteja ligado)
                    if (estado) {
                        $("#imagem").attr("src", "temperatura.png");
                        $("#estado").html("Ligado");
                        $("#btn-io").html("Desligar");
                        $("#opcoes").show();
                    } else {
                        $("#imagem").attr("src", "arcondicionado-desligado.png");
                        $("#estado").html("Desligado");
                        $("#btn-io").html("Ligar");
                        $("#opcoes").hide();
                    }
                });

            }

            function exibirTemperatura() {

                $.getJSON("http://localhost:8080/ProjetoMQTT/api/arcondicionado/temperatura", function (resultado) {
                    temperatura = resultado.temperatura;
                    if (temperatura) {
                        $("#temperatura").html(temperatura);

                        if (temperatura === temperaturaMaxima) {
                            $("#btn-aumentar").attr("disabled", "disabled");
                        }
                        if (temperatura === temperaturaMinima) {
                            $("#btn-diminuir").attr("disabled", "disabled");
                        }
                    }
                });

            }

        </script>
    </head>

    <body>
        <!--        <form action="http://localhost:8080/ProjetoMQTT/api/lampada/ligar" method="POST">
                    <button type="submit">Mudar Status</button>
                </form>-->
        <div id="index">
            <div>
                <button id="btn-io" class="btn btn-primary">Ligar</button>
            </div>
            <div id="arcondicionado">
                <h1>Arcondicionado: <span id="estado"></span></h1>
                <img id="imagem" src="arcondicionado-desligado.png" alt="Ar Condicionado"/>
            </div>
            <div id="opcoes" style="display: none">
                <button id="btn-aumentar" class="btn btn-primary">Aumentar</button>
                <h1>TEMPERATURA: <span id="temperatura"></span></h1>
                <button id="btn-diminuir" class="btn btn-primary">Diminuir</button>
            </div>

        </div>

    </body>
</html>
